# Cosmos网络
Tendermint团队提出了专属区块链（application specific blockchain)系统的理念，为每一个区块链应用单独构建一条区块链。为了阻止应用专属区块链系统形成价值孤岛，Tendermint构建了**IBC**协议来连接所有的应用专属区块链系统，以构建互联互通的区块链网络。同时为了降低应用专属区块链系统开发的技术门槛及缩短开发周期，Tendermint使用了**Tendermint Core、Cosmos-SDK**提供了区块链的开发框架。基于这两个项目构建的区块链应用自动继承Tendermint共识协议以及POS机制。继承了秒出快的特性并避免了资源的大量浪费。

Cosmos，意为“宇宙”，用IBC协议连接互相独立的区块链，每个应用专属区块链在Cosmos生态中被称作Zone，所有Zone由Tendermint Core驱动，并且可以基于Cosmos-SDK来快速构建。

IBC协议介绍：https://zhuanlan.zhihu.com/p/523778488

## Cosmos Hub
是Cosmos网络的第一个Zone，采用POS机制并支持多种链上资产，其原生链上资产是名为ATOM的通证，可用于参加POS机制中的链上资产抵押及链上治理。

Cosmos Hub网络的三阶段启动：

*第一阶段*：网络趋于稳定。新启动的主网可能不太稳定，可能会出现网络暂定等故障。在来链上交易开启之前，如果出现此类故障，Cosmos Hub网络可以回滚至任意状态，甚至回滚到创世区块。但是链上交易一旦开始，就很难再进行回滚操作。

*第二阶段*：链上交易开始。主网足够稳定之后，再链上抵了ATOM的通证持有人可以通过链上治理过程投票决定是否开启链上交易功能，链上交易功能开启之后，用户可以在来链上进行ATOM转账操作。

*第三阶段*：启动IBC协议。IBC协议发布并完成开发之后，在链上抵押了ATOM的通证持有人通过链上治理的方式决定是否在主网开启IBC协议。此时任何基于Tendermint Core和Cosmos-SDK构建的应用专属区块链系统都可以通过IBC进行跨链通信。

任意两个区块链如果想要通过IBC协议进行互操作，只需要与Cosmos Hub建立连接，而无须通过IBC协议直接建立连接。Cosmos Hub在Cosmos网络中扮演着跨链通信中心枢纽的作用，可以降低区块链应用之间互操作的复杂度。任意团队都可以构建额外的Hub网络，Hub网络之间也通过IBC进行跨链通信。

## Tendermint Core
Tendermint团队将区块链系统自上向下的拆分为三层：

上层应用层：根据共识协议层构建的区块，通过ABCI与上层应用交互，执行区块中的交易并完成上层应用的状态更新。

共识协议层：构建新的区块，并通过共识协议确保全网就区块内容（交易、上层应用状态）达成共识。

对等网络通信层：对等网络通信，确保交易、区块、共识协议的信息能够快速的在整个网络中进行广播。

Tendermint Core中提供了对等网络通信层与共识协议层的实现，并抽象出区块链应用接口(application blockchain interface,ABCI)来完成共识协议层与上层应用层的互动。

共识协议层并不关心交易的具体内容，而将交易看成简单的字节切片。在全网就交易顺序达成共识，Tendermint Core要求上层应用状态更新是确定性过程，即从相同的初始状态开始，按照相同的顺序来处理交易之后，上层应用的状态在全网之间应保持一致。为了确保这种状态更新的一致性，共识协议层在利用区块就交易顺序达成共识之外，也会对区块中包含的上层应用状态的“数字指纹”，确保在每个区块执行之前，全网对上层应用状态也达成共识。

基于BFT的Tendermint共识协议，在支撑几百个共识节点的情况下，依然可以实现秒级出块的速度。Tendermint共识协议逐块最终化(finality)的特性，既保证了区块链不会发生比特币或者以太坊中的重组事件，也实现了交易的秒级确认。

BFT共识协议通常要求在执行一轮共识协议之前，要先确定协议的验证者。但Tendermint Core并没有硬编码选择验证者的规则，而是通过适当的机制设计以及ABCI，为上层应用保留了更新验证者集合的权利。

Tendermint共识协议在每一轮共识协议执行开始前，都会有一个验证者成为新区块提案者(proposer)，提案者通过打包交易构建新的区块，并通过对等网络将区块广播到全网。所有验证者根据收到的信息和自身状态就区块内容进行两阶段投票:预投票(prevote)和预交(precommit)。Tendermint共识协议执行过程。投票可投给新构造的区块，表示验证者认同该区块内容;也可以投给空值，表示验证者因为某种原因无法认同该区块的内容。对区块足够多的预投票(超过2/3)，可以促使验证者进人下一阶段的投票过程;而针对区块足够多(超过2/3)的预提交，可以促使所有节点提交(commit)该区块。区块被提交之后，Core的共识协议层通过ABCI 与上层应用互动，完成区块内交易的处理，执行结果也通过ABCI返回给共识协议层。

## Cosmos-SDK

Cosmos-SDK，实现了区块链场景中一系列的通用功能模块，以显著提升上层应用的开发效率。

Cosmos的模块划分：

**基础功能**：账户管理与交易处理

auth模块管理系统中的所有账户；bank模块管理链上资产的转移

**辅助模块**：创世区块管理、链上状态一致性检查等

genutil模块管理链的创世纪块;supply模块负责链上资产总量的管理;

crisis负责所有模块的不变量检查的管理;params模块负责所有模块的参数管理。

**链上治理**：基于提案的链上治理与网络升级

gov模块负责链上治理机制；upgrade模块负责链的升级

**POS**:链上资产抵押、链上惩罚和奖励

staking模块管理链上资产抵押;slashing模块负责对验证者的被动作恶行为进行惩罚;

evidence模块负责对验证者的主动作恶行为进行惩罚;mint模块负责链上资产的铸造;

distribution模块管理区块奖励的分发

**IBC协议**：基于中继机制的跨链协议

ibc/core模块负责跨链通信功能

*安全性的保障手段*：每个模块仅对外暴露必要的功能接口，赋予每个模块单独存储空间。Cosmos-SDK也为每个模块设计了守护者（keeper)角色来维护和更新每个区块的状态。每个守护者隐藏了模块内部的具体实现以及存储设计，模块之间的配合通过各个模块的守护者之间的相互调用来完成，可以保证每个模块内部状态只会被本身模块的守护者更新，也保证了链上状态的唯一性。

## IBC协议

IBC协议的完整协议规范文档见GitHub仓库"cosmos/ics"

IBC协议是基于中继机制而逐步演算出的协议，核心机制的原理是：任意两个希望跨链通信的区块链可以依靠密码学证明技术向对方证明自身链上发生了特定的事件。两条链之间的网络通信通过中继者(relayer)完成。




